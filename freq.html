<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
        <title>SpectrumAnalyzer</title>

        <script src="https://cdn.socket.io/4.1.2/socket.io.min.js"
            integrity="sha384-toS6mmwu70G0fw54EGlWWeA4z3dyJ+dlXBtSURSKN4vyRFOcxd3Bzjj/AoOwY+Rg"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.4.1/dist/chart.min.js"></script>
        <script>
            const socket = io("http://127.0.0.1:8080");
            socket.on("connect", () => {
                console.log('connected'); 
            });
        </script>
        <style>
            .controlbox{
                position: absolute;
                border-radius: 3px;
                top: 15px;
                left: 50px;
                width:50px;
                height:50px;
                font-family: sans-serif;
                color: #744c29;
                font-size: 2em;
                /* display: none; */
            }
        </style>
    </head>
    
    <body>
        <div class="controlbox position-fixed">
           <h1 id="decode"></h1>
        </div>
        <div class="chart-container" style="position: relative; height:100%; width:100%;bottom: 0px;">
            <canvas id="chart"></canvas>
        </div>
        <script>
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            var data= {
                    labels: [],
                    datasets: [{
                        data: [],
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                        fill: true,
                        backgroundColor : 'rgb(75, 192, 192,1)'
                    }]
                };
            socket.on("spectrum", data => {
                    // console.log(data);
                    myChart.data.labels = data['x'];
                    myChart.data.datasets[0].data = data['y'];
                    var x = document.getElementById("decode");

                    if (data['key']!='NULL' && urlParams.has("decode")) {
                        x.innerText = data['key'];
                    }else{
                        x.innerText = "";
                    }
                    myChart.update();

                });

            const config = {
                type: 'bar',
                data: data,
                options:{
                    plugins:{
                        legend: {
                            display: false,
                        }
                    },
                    scales: {
                        y: {
                            // type: 'logarithmic',
                            min:0,
                            max:100,
                            display:false
                        },
                        x:{
                            display:false
                        }
                    }
                }
            };
            // === include 'setup' then 'config' above ===

            var myChart = new Chart(
                document.getElementById('chart'),
                config
            );
        </script>
    </body>
    </html>