<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>吹直笛打電話？重現柯南名場景！ - PyConTW 21</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/mathhack.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section >
					<div class="titlepage">
						<br><br>
						<h3 style="margin-left:-3.5em">吹直笛打電話？</h3><br>
						<h3 style="padding-left:3.5em;margin-top: -50px;">重現柯南名場景！</h3>
						<br>
						<p>Yu-Hsun Lee <br><sub>@PyConTW 2021</sub></p>
					</div>

					
				</section>
				<section data-background-image="https://vbmspic.video.friday.tw/STILL/13100/13100_13124698_M.jpg" data-background-opacity="0.3">
					<img width="750px" src="https://vbmspic.video.friday.tw/STILL/13100/13100_13124698_M.jpg"></img>
					<h5>名偵探柯南－戰慄的樂譜 (2008)</h5>
					<!-- <sup>https://video.friday.tw/movie/detail/13100</sup> -->
				</section>
				<section>
					<img width="400px" src="dist/img/logo.png"></img>
					<h3 class="mathhack">數學建模黑客松</h3>
				</section>
				<section data-background-image="dist/img/intro.png" data-transition-speed="slow">
				</section>
				<section data-background-iframe="dist/iframe/noti.html">
					<div class="container mh-message" >
						<!-- <div class="content"> -->
							<p class="fragment" data-fragment-index="1">你們似乎已經抵達出口附近，但是依然有碎石擋住，</p>
							<p class="fragment" data-fragment-index="2">確認你們的位置後，調查團會⽤⼯具打通⼀條通路，</p>
							<p class="fragment" data-fragment-index="3">不過因為目前遺跡構造不穩，不能隨意開挖，</p>
							<p class="fragment" data-fragment-index="4">只能等你們提供所在位置後才能打通。</p>
							<p class="fragment" data-fragment-index="5">因為遺跡內不穩，所有⾏為都可能導致崩塌，</p>
							<p class="fragment" data-fragment-index="6">不要⼤聲呼叫、拍打，</p>
							<p class="fragment" data-fragment-index="7">請⽤其他的⽅式，設法通知調查團你們的所在位置。</p>
						<!-- </div> -->
					</div>
				</section>
				<section data-transition="zoom">
					<div class="container">
					<img width="500px" src="dist/img/gps.png" style="border: 2px solid #555;"></img>
					</div>
				</section>
				<section data-background-image="dist/img/telebooth.png" data-transition-speed="slow"></section>
				<section>
					<div class="wave wp1" data-fragment-index="1">
						<h5>直笛?!</h5>
						<img height="450px" src="dist/img/phone_recorder.jpeg"></img>
					</div>
				</section>
				<section>
					<table class="tg">
						<thead>
							<tr>
								<th class="tg-baqh tg-rh"></th>
								<th class="tg-baqh">1209 Hz</th>
								<th class="tg-baqh">1336 Hz</th>
								<th class="tg-baqh">1477 Hz</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td class="tg-baqh tg-rh">697 Hz</td>
								<td class="tg-baqh">1</td>
								<td class="tg-baqh">2</td>
								<td class="tg-baqh">3</td>
							</tr>
							<tr>
								<td class="tg-baqh tg-rh">770 Hz</td>
								<td class="tg-baqh">4</td>
								<td class="tg-baqh">5</td>
								<td class="tg-baqh">6</td>
							</tr>
							<tr>
								<td class="tg-baqh tg-rh">852 Hz</td>
								<td class="tg-baqh">7</td>
								<td class="tg-baqh">8</td>
								<td class="tg-baqh">9</td>
							</tr>
							<tr>
								<td class="tg-baqh tg-rh">941 Hz</td>
								<td class="tg-baqh">*</td>
								<td class="tg-baqh">0</td>
								<td class="tg-baqh">#</td>
							</tr>
						</tbody>
					</table>
				</section>
				
				<section>
					<h3>雙音多頻訊號</h3>
					<sup>Dual-Tone Multi-Frequency, DTMF</sup>
				</section>
				<section>
					<div class="owaves">
						<div class="wave w1 fragment" data-fragment-index="1" onclick="play('audio_low')">
							<img height="100px" src="dist/img/sin1.png"></img>
							<audio id="audio_low" src="dist/audio/1_low.m4a"></audio>
							<h5>低頻</h5>
						</div>
						<div class="wave wp fragment" data-fragment-index="2">
							<img height="40px" src="dist/img/plus.png"></img>
						</div>
						<div class="wave w2 fragment" data-fragment-index="2" onclick="play('audio_high')">
							<img height="100px" src="dist/img/sin2.png"></img>
							<audio id="audio_high" src="dist/audio/1_high.m4a"></audio>
							<h5>高頻</h5>
						</div>
						<div class="wave we fragment" data-fragment-index="3">
							<img height="13px" src="dist/img/equal.png"></img>
						</div>
						<div class="wave wp1 fragment" data-fragment-index="3" onclick="play('audio_tone')">
							<img height="160px" src="dist/img/sin1p2.png"></img>
							<audio id="audio_tone" src="dist/audio/1_tone.m4a"></audio>

						</div>
					</div>
				</section>
				<section>
					<div class="owaves">
						<div class="wave wp1" data-fragment-index="1" onclick="play('audio_tone')">
							<img height="160px" src="dist/img/sin1p2.png"></img>
							<audio id="audio_tone" src="dist/audio/1_tone.m4a"></audio>

						</div>
						<div class="wave we fragment" data-fragment-index="2">
							<img height="13px" src="dist/img/equal.png"></img>
						</div>
						<div class="wave w1 fragment" data-fragment-index="2">
							<img height="80px" src="dist/img/question.png"></img>
						</div>
						<div class="wave wp fragment" data-fragment-index="3">
							<img height="40px" src="dist/img/plus.png"></img>
						</div>
						<div class="wave w2 fragment" data-fragment-index="3">
							<img height="80px" src="dist/img/question.png"></img>
						</div>
					</div>
				</section>
				<section>
					<h3>傅立葉轉換</h3>
					<sup>Fourier Transform</sup>
				</section>
				<section data-background-iframe="dist/iframe/freq.html?keypad=1" data-background-interactive>
					<br><br><br><br><br><br><br><br><br><br><br><br>
					<h5>頻譜分析</h5>
					<!-- <iframe data-src= style="width:80%;height:60%"></iframe> -->
				</section>
				<section>
					<h5>Example Code - PyAudio</h5>
					<pre><code data-trim data-noescape  class="python">
import pyaudio
import numpy as np
pa = pyaudio.PyAudio()
stream = pa.open(format = pyaudio.paInt16,
                 channels = 1,
                 rate = 44100,
                 input_device_index = INPUT_DEVICE_INDEX,
                 input = True,
                 output = False,
                 frames_per_buffer = 8192)
while True:
    au_buffer = stream.read(8192, exception_on_overflow = False)
    au_array = np.frombuffer(au_buffer, dtype = np.int16)
    spec_x = np.fft.fftfreq(8192, d = 1.0 / 44100 )
    spec_y = np.abs(np.fft.fft(au_array))
					  </code></pre>
				</section>
				<section>
					<h5>Example Code - Peak Finding</h5>
					<pre><code data-trim data-noescape class="python">
def findfreq(spec_x,spec_y):
    kidx = np.abs(spec_x - 1000).argmin()
    index1 = np.argmax(spec_y[:kidx])
    index2 = np.argmax(spec_y[kidx:4096]) + kidx
    return (spec_x[index1], spec_x[index2])
					</code></pre>
				</section>
				<section>
					<h5>Example Code - DTMF Decode</h5>
					<pre><code data-trim data-noescape class="python">
def dtmf(freq1, freq2):
    keypad = [["1", "2", "3", "A"],
              ["4", "5", "6", "B"],
              ["7", "8", "9", "C"],
              ["*", "0", "#", "D"]]
    row = np.array([697, 770, 852, 941])			
    col = np.array([1209, 1336, 1477, 1633])
    ridx = np.where(np.abs(row - freq1) < 25)[0]
    cidx = np.where(np.abs(col - freq2) < 25)[0]
    try: 
        k = keypad[ridx[0]][cidx[0]]
    except: 
        k = None 
    return k
					</code>
					
				</section>
				<section data-background-iframe="dist/iframe/freq.html?decode=1&keypad=1" data-background-interactive>
					<br><br><br><br><br><br><br><br><br><br><br><br>
					<h5>頻譜分析（解碼中）</h5>
					<!-- <iframe data-src= style="width:80%;height:60%"></iframe> -->
				</section>
				<section>
					<h3>硬體介紹與控制</h3>
				</section>
				<section>
					<h5>流程架構</h5>
					<div class="wave wp1 fragment" data-fragment-index="1">
						<img height="120px" src="dist/img/recorder2.png"></img>
						<p>聲音訊號</p>
					</div>
					<div class="wave wp1 fragment" data-fragment-index="2">
						<img height="120px" src="dist/img/rasp.png"></img>
						<p>樹莓派+USB音效卡</p>
					</div>
					<div class="wave wp1 fragment" data-fragment-index="3">
						<img height="80px" src="dist/img/relay.png"></img>
						<p>繼電器模組</p>
					</div>
					<div class="wave wp1 fragment" data-fragment-index="4">
						<img height="100px" src="dist/img/eleclock.png"></img>
						<p>電控鎖</p>
					</div>
				</section>
				<section>
					<h5>電控鎖</h5>
					<div class="wave wp1" data-fragment-index="4">
						<img height="300px" src="dist/img/eleclock2.png"></img>
						<p>陽極鎖（通電鎖門）</p>
					</div>
					<div class="wave wp1" data-fragment-index="4">
						<img height="300px" src="dist/img/eleclock1.png"></img>
						<p>陰極鎖（通電開門）</p>
					</div>
				</section>
				<section data-transition="fade">
					<h5>繼電器模組</h5>
					<div class="wave wp1 " data-fragment-index="1">
						<img height="300px" src="dist/img/relay1.png"></img>
					</div>
				</section>
				<section data-transition="fade">
					<h5>繼電器模組</h5>
					<div class="wave wp1" data-fragment-index="1">
						<img height="300px" src="dist/img/relay_circuit.png"></img>
					</div>
				</section>
				
				<section data-transition="fade">
					<h5>繼電器模組</h5>
					<div class="wave wp1" data-fragment-index="1">
						<img height="300px" src="dist/img/relay_low.png"></img>
					</div>
				</section>
				<section data-transition="fade">
					<h5>繼電器模組</h5>
					<div class="wave wp1" data-fragment-index="1">
						<img height="300px" src="dist/img/relay_high.png"></img>
					</div>
				</section>
				<section>
					<h5>組裝電路</h5>
					<div class="wave wp1" data-fragment-index="1">
						<img height="300px" src="dist/img/connection.png"></img>
					</div>
				</section>
				<section>
					<h5 >Example Code - Relay</h5>
					<pre><code data-trim data-noescape>
					import pigpio

					relay = 23 # GPIO

					pi = pigpio.pi() # Access the local Pi's GPIO
					pi.set_mode(relay, pigpio.OUTPUT) # Set GPIO to output mode

					pi.write(relay, 0) # LOW, Door Locked
					pi.write(relay, 1) # HIGH, Door Unlocked
					  </code></pre>
				</section>
				<section>
					<h3 style="font-style: italic;">成品展示</h3>
				</section>
				
				<section data-background-image="dist/img/IMG_3396.JPG"></section>
				<section data-background-image="dist/img/phone_all.jpg"></section>
				<section data-background-image="dist/img/phone_edit_0.jpeg"></section>
				<section data-background-image="dist/img/phone_edit_1.jpeg"></section>
				<section data-background-image="dist/img/phone_edit_2.jpeg"></section>
				<section data-background-image="dist/img/phone_edit_3.jpeg"></section>
				<section data-background-image="dist/img/phone_play.jpg"></section>
				<section>
					<h3 style="font-style: italic;">Demo</h3>
				</section>
                <section data-transition="fade-out">
                    <div class="container">
                        <img width="500px" src="dist/img/gps.png" style="border: 2px solid #555;"></img>
                    </div>
                </section>
                <section data-transition="fade-out">
                    <div class="container">
                        <img width="500px" src="dist/img/gps_sol.png" style="border: 2px solid #555;"></img>
                    </div>
                </section>
				<section>
					<h3></h3>
				</section>
				<section>
					<h3 >Q&A</h3>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				progress: false,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
		<script>
			function play(id) {
				var audio = document.getElementById(id);
				audio.play();
			}
		</script>
	</body>
</html>
